//Database
const questionsDatabase = {
    citizenshipQuiz: {
        "1": {
            question: "What was the last battle between Great Britain and France?",
            answers: {
                "one": "The Battle of Trafalgar",
                "two": "The Battle of Waterloo",
                "three": "The Battle of Hastings",
                "four": "The Battle of Agincourt",
                "correctAnswer": "two" 
            }
        },
        "2": {
            question: "Which flower is associated with Wales?",
            answers: {
                "one": "Daffodil",
                "two": "Rose",
                "three": "Shamrock",
                "four": "Thistle",
                "correctAnswer": "one" 
            }
        },
        "3": {
            question: "How often are general elections in the UK?",
            answers: {
                "one": "Every 3 years",
                "two": "Every 4 years",
                "three": "Every 5 years",
                "four": "Every 6 years",
                "correctAnswer": "three" 
            }
        },
        "4": {
            question: "Which charity works to preserve important buildings?",
            answers: {
                "one": "NSPCC",
                "two": "The Red Cross",
                "three": "Age UK",
                "four": "The National Trust",
                "correctAnswer": "four" 
            }
        },
        "5": {
            question: "What is the capital of Scotland?",
            answers: {
                "one": "Edinburgh",
                "two": "London",
                "three": "Belfast",
                "four": "Cardiff",
                "correctAnswer": "one" 
            }
        },
        "6": {
            question: "Which department produces the the official handbook for the test?",
            answers: {
                "one": "The English Office",
                "two": "The Home Office",
                "three": "The State Office",
                "four": "The Foreign Office",
                "correctAnswer": "two" 
            }
        },
        "6": {
            question: "Which department produces the the official handbook for the test?",
            answers: {
                "one": "The English Office",
                "two": "The Home Office",
                "three": "The State Office",
                "four": "The Foreign Office",
                "correctAnswer": "two" 
            }
        },
        "7": {
            question: "In which year was there a major outbreak of plague in London?",
            answers: {
                "one": "1465",
                "two": "1565",
                "three": "1665",
                "four": "1765",
                "correctAnswer": "three" 
            }
        },
        "8": {
            question: "In which county is Stonehenge?",
            answers: {
                "one": "Lincolnshire",
                "two": "Lothians",
                "three": "Dorset",
                "four": "Wiltshire",
                "correctAnswer": "four" 
            }
        },
        "9": {
            question: "What is the name given to rented additional land which people use to grow fruits and vegetables?",
            answers: {
                "one": "Allotment",
                "two": "Roomage",
                "three": "Spacage",
                "four": "Garden",
                "correctAnswer": "one" 
            }
        },
        "10": {
            question: "What do many theatres produce at Christmas time?",
            answers: {
                "one": "New Years Celebration",
                "two": "Tragedy Play",
                "three": "Huge Display",
                "four": "Pantomime",
                "correctAnswer": "four" 
            }
        },
        "11": {
            question: "Who became Prime Minister during WWII?",
            answers: {
                "one": "Robert Walpole",
                "two": "Tony Blair",
                "three": "Margaret Thatcher",
                "four": "Winston Churchill",
                "correctAnswer": "four" 
            }
        },
        "12": {
            question: "Who do you write to to make a complaint about the police?",
            answers: {
                "one": "The Chief Constable",
                "two": "Your local MP",
                "three": "The House of Lords",
                "four": "The House of Commons",
                "correctAnswer": "one" 
            }
        }
    },

    oscarsQuiz: {
        "1": {
            question: "Who has hosted the Oscars the most times?",
            answers: {
                "one": "Chevy Chase",
                "two": "Bob Hope",
                "three": "David Letterman",
                "four": "Billy Crystal",
                "correctAnswer": "two"
            }
        },
        "2": {
            question: "Which is the longest film to have won an Oscar for best picture?",
            answers: {
                "one": "Titanic",
                "two": "Genghis Khan",
                "three": "The Trial of the Chicago 7",
                "four": "Gone with the Wind",
                "correctAnswer": "four"
            }
        },
        "3": {
            question: "Who is the oldest actress to win an Oscar?",
            answers: {
                "one": "Maggie Smith",
                "two": "Diana Ross",
                "three": "Judi Dench",
                "four": "Jessica Tandy",
                "correctAnswer": "four"
            }
        },
        "4": {
            question: "Who was the first female producer to win an Academy Award for Best Picture?",
            answers: {
                "one": "Diablo Cody",
                "two": "Julia Phillips",
                "three": "Julia Roberts",
                "four": "Kathryn Bigelow",
                "correctAnswer": "two"
            }
        },
        "5": {
            question: "Which is the longest film to win an Academy Award for Best Foreign Language Film?",
            answers: {
                "one": "Parasite",
                "two": "The Discreet Charm of the Bourgeoisie",
                "three": "Oldboy",
                "four": "War and Peace",
                "correctAnswer": "four"
            }
        },
        "6": {
            question: "Who was the first woman to win an Oscar for best director?",
            answers: {
                "one": "Sofia Coppola",
                "two": "Chloe Zhao",
                "three": "Kathryn Bigelow",
                "four": "Frances McDormand",
                "correctAnswer": "three"
            }
        },
        "7": {
            question: "Which was the first animated film to be nominated for an Oscar for Best Picture?",
            answers: {
                "one": "Toy Story",
                "two": "Beauty and the Beast",
                "three": "Up",
                "four": "The Lion King",
                "correctAnswer": "two"
            }
        },
        "8": {
            question: "In which year was the first Academy Awards?",
            answers: {
                "one": "1925",
                "two": "1929",
                "three": "1937",
                "four": "1947",
                "correctAnswer": "two"
            }
        },
        "9": {
            question: "What was the original title of the Best Picture category?",
            answers: {
                "one": "Outstanding Picture",
                "two": "Best Motion Picture",
                "three": "Outstanding Motion Picture",
                "four": "unique and Artistic Picture",
                "correctAnswer": "one"
            }
        },
        "10": {
            question: "Which movie was the Best Picture winner in 1963, when the category was renamed to Best Picture?",
            answers: {
                "one": "Lolita",
                "two": "To Kill A Mockingbird",
                "three": "Lawrence of Arabia",
                "four": "The Miracle Worker",
                "correctAnswer": "three"
            }
        },
        "11": {
            question: "Who has won the Best Actor the most times?",
            answers: {
                "one": "Daniel Day-Lewis",
                "two": "Peter O'Toole",
                "three": "Laurence Olivier",
                "four": "Anthony Hopkins",
                "correctAnswer": "one"
            }
        },
        "12": {
            question: "Where are the Academy Awards held?",
            answers: {
                "one": "The Beverly Hilton, Los Angeles",
                "two": "The Plaza Hotel, New York",
                "three": "The Shrine Auditorium, Los Angeles",
                "four": "The Dolby Theatre, Los Angeles",
                "correctAnswer": "four"
            }
        },
    }
};

//Global variables
let currentQuiz = questionsDatabase.citizenshipQuiz;
let currentQuestionNumber = 1;
let numberOfQuestions = Object.keys(currentQuiz).length;
let currentQuestionIsUnanswered = true;
let numAnsweredQuestions = 0;
let numCorrectAnswers = 0;

//DOM structure
const showHideButton = document.getElementById("showHideButton");
const loadQuizButton = document.getElementById("loadQuizButton");
const quizSelector = document.getElementById("quizSelector");
const selectCitizenshipButton = document.getElementById("selectCitizenshipButton");
const selectOscarsButton = document.getElementById("selectOscarsButton");
const progressTracker = document.getElementById("progressTracker");
const progressBar = document.getElementById("progressBar");
const progressPercentage = document.getElementById("progressPercentage")
const question = document.getElementById("question");
const questionContainer = document.getElementById("questionContainer");
const one = document.getElementById("one");
const two = document.getElementById("two");
const three = document.getElementById("three");
const four = document.getElementById("four");
const nextButton = document.getElementById("nextButton");

//Navigation Bar Functions
const showPossibleQuizes = function() {
    (quizSelector.style.display === "block") ? quizSelector.style.display = "none" : quizSelector.style.display = "block";
};

//Functions
const loadQuiz = function(selectedQuiz) {
    //Change quiz
    currentQuiz = selectedQuiz;

    //Clear anything previously loaded
    progressBar.innerHTML = "";
    progressPercentage.innerHTML = "";
    currentQuestionNumber = 1;
    numberOfQuestions = Object.keys(currentQuiz).length;
    currentQuestionIsUnanswered = true;
    numAnsweredQuestions = 0;
    numCorrectAnswers = 0;    
    resetQuestionStyling();

    //Generate progress bars
    for (let i = 1; i < numberOfQuestions + 1; i++) {
        let generatedDiv = document.createElement("div");
        generatedDiv.setAttribute("class", "progressNode");
        generatedDiv.setAttribute("id", `node${i}`);
        generatedDiv.innerHTML = i;
        progressBar.appendChild(generatedDiv);
    };

    //Generate progress percentage
    let progressString = `Question - ${currentQuestionNumber} of ${numberOfQuestions}`;
    progressPercentage.innerHTML = progressString;

    //Generate first question
    question.innerHTML = `${currentQuestionNumber}. ${currentQuiz[currentQuestionNumber].question}`;
    one.innerText = currentQuiz[currentQuestionNumber].answers["one"];
    two.innerText = currentQuiz[currentQuestionNumber].answers["two"];
    three.innerText = currentQuiz[currentQuestionNumber].answers["three"];
    four.innerText = currentQuiz[currentQuestionNumber].answers["four"];
};
const resetQuestionStyling = function() {
    one.style.border = "medium none";
    one.style.backgroundColor = "rgb(75, 75, 75)";
    two.style.border = "medium none";
    two.style.backgroundColor = "rgb(75, 75, 75)";
    three.style.border = "medium none";
    three.style.backgroundColor = "rgb(75, 75, 75)";
    four.style.border = "medium none";
    four.style.backgroundColor = "rgb(75, 75, 75)";
};
const displayNextQuestion = function() {
    if (currentQuestionNumber === numberOfQuestions) {
        alert("Reached the end of the quiz");
        return
    } else if (currentQuestionIsUnanswered === true) {
        alert("Answer the question before moving on!");
    } else {
        console.log("Changing currentQuestionIsUnanswered to true...");
        currentQuestionNumber++;
        generateQuestionHTML(currentQuestionNumber);
        resetQuestionStyling();
        currentQuestionIsUnanswered = true;
        return
    };   
};
const generateQuestionHTML = function(number) {
    let questionText = currentQuiz[number].question;
    let answerOne = currentQuiz[number].answers.one;
    let answerTwo = currentQuiz[number].answers.two;
    let answerThree = currentQuiz[number].answers.three;
    let answerFour = currentQuiz[number].answers.four;

    question.innerHTML = questionText;
    one.innerHTML = answerOne;
    two.innerHTML = answerTwo;
    three.innerHTML = answerThree;
    four.innerHTML = answerFour;

    let questionHTML = document.getElementById("questionContainer");
    console.log(questionHTML);
    return
};
const updateProgress = function(answerIsCorrect) {
    //Progress Bar
    let currentQuestionNode = document.getElementById(`node${currentQuestionNumber}`);
    if (answerIsCorrect === true) {
        currentQuestionNode.style.backgroundColor = "green";
    } else {
        currentQuestionNode.style.backgroundColor = "red";
    };

    //Score 
    let percentageCorrect = Math.round(numCorrectAnswers / numAnsweredQuestions * 100);
    let progressString = 
        `Question ${currentQuestionNumber} of ${numberOfQuestions} | Score - ${numCorrectAnswers} out of ${numAnsweredQuestions} - ${percentageCorrect}%`;
    progressPercentage.innerHTML = progressString;
};
const checkAnswer = function(selectedAnswer) {
    let correctAnswer = currentQuiz[currentQuestionNumber].answers.correctAnswer;
    if (selectedAnswer !== correctAnswer) {
        console.log("Incorrect answer!");
        numAnsweredQuestions++;
        return false
    } else {
        console.log("Correct answer!");
        numAnsweredQuestions++;
        numCorrectAnswers++;
        return true
    };
};
const executeAnswer = function(selectedAnswer) {
    if (currentQuestionIsUnanswered) {
        let answerIsCorrect = checkAnswer(selectedAnswer);
        let answerDiv = document.getElementById(selectedAnswer);
        updateProgress(answerIsCorrect);
        currentQuestionIsUnanswered = false;
        if (answerIsCorrect) {
            answerDiv.style.backgroundColor = "darkgreen";
            answerDiv.style.borderLeft = "4px solid black";
        } else {
            answerDiv.style.backgroundColor = "darkred";
            answerDiv.style.borderLeft = "4px solid black";
        };
    } else {
        console.log("Question has already been answered");
    };
};

//EventListeners
loadQuizButton.addEventListener("click", showPossibleQuizes);
selectCitizenshipButton.addEventListener("click", function() {
    loadQuiz(questionsDatabase.citizenshipQuiz);
});
selectOscarsButton.addEventListener("click", function() {
    loadQuiz(questionsDatabase.oscarsQuiz);
});
one.addEventListener("click", function() {
    console.log("Executing answer one...");
    executeAnswer("one");
});
two.addEventListener("click", function() {
    executeAnswer("two");
});
three.addEventListener("click", function() {
    executeAnswer("three");
});
four.addEventListener("click", function() {
    executeAnswer("four");
});
nextButton.addEventListener("click", displayNextQuestion);

//Generate Quiz
loadQuiz(questionsDatabase.citizenshipQuiz);